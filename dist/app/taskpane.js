(()=>{var e,t,n,a={195:()=>{},1671:()=>{},5352:()=>{},5365:()=>{},6575:(e,t,n)=>{"use strict";var a=n(4848),s=n(6540),i=n(5338),r=n(20),o=n(1660),c=n(6366),l=n(5425);r.GlobalWorkerOptions.workerSrc=Office.context.document.url.replace(/[^/]+$/,"")+"pdf.worker.min.js";const d=({buffer:e,onSelect:t,isSelectionMode:n,currentMode:i,highlightRect:d=null,highlightPage:u=null})=>{const g=(0,s.useRef)(null),[f,h]=(0,s.useState)(null),[p,x]=(0,s.useState)(1),[y,m]=(0,s.useState)(0),[w,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),[M,k]=(0,s.useState)(!1),[S,C]=(0,s.useState)(null),[O,E]=(0,s.useState)(null);return(0,s.useEffect)((()=>{if(!e)return h(null),m(0),void x(1);b(!0),j(null),(0,r.getDocument)({data:e}).promise.then((e=>{h(e),m(e.numPages),x(1),b(!1)})).catch((e=>{console.error("Error loading PDF:",e),j("Failed to load PDF document"),b(!1)}))}),[e]),(0,s.useEffect)((()=>{u&&u!==p&&x(u)}),[u]),(0,s.useEffect)((()=>{f&&g.current&&(async()=>{b(!0);try{const e=await f.getPage(p),t=e.getViewport({scale:1.25}),n=g.current;n.width=t.width,n.height=t.height;const a=n.getContext("2d");await e.render({canvasContext:a,viewport:t}).promise,b(!1)}catch(e){console.error("Error rendering page:",e),j("Failed to render page"),b(!1)}})()}),[f,p]),e?v?(0,a.jsxs)("div",{style:{padding:"20px",color:"#d13438"},children:["Error: ",v]}):(0,a.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",background:"#fff",borderBottom:"1px solid #ddd"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)(o.$,{size:"small",appearance:"subtle",icon:(0,a.jsx)(l.Osk,{}),disabled:p<=1,onClick:()=>{p>1&&x(p-1)},children:"Prev"}),(0,a.jsxs)(c.E,{size:200,style:{margin:"0 8px"},children:["Page ",p," of ",y]}),(0,a.jsx)(o.$,{size:"small",appearance:"subtle",icon:(0,a.jsx)(l.Fqy,{}),iconPosition:"after",disabled:p>=y,onClick:()=>{p<y&&x(p+1)},children:"Next"})]}),i&&(0,a.jsxs)("div",{style:{padding:"4px 8px",background:"#0078d4",color:"white",borderRadius:"3px",fontSize:"11px",fontWeight:500,textTransform:"uppercase"},children:[i," Mode"]})]}),(0,a.jsx)("div",{style:{flex:1,overflow:"auto",background:"#f0f0f0"},children:w?(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px",color:"#666",fontSize:"14px"},children:"Loading..."}):(0,a.jsx)("div",{style:{position:"relative",display:"flex",justifyContent:"center",minHeight:"100%",alignItems:"flex-start",padding:"20px"},children:(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("canvas",{ref:g,style:{border:"1px solid #ccc",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",background:"white",cursor:n?"crosshair":"default"},onMouseDown:e=>{if(!n||!g.current)return;const t=g.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top;k(!0),C({x:a,y:s}),E(null)},onMouseMove:e=>{if(!M||!S||!g.current)return;const t=g.current.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,s={x:Math.min(S.x,n),y:Math.min(S.y,a),width:Math.abs(n-S.x),height:Math.abs(a-S.y)};E(s)},onMouseUp:e=>{if(!M||!S||!g.current)return;const n=g.current,a=n.getBoundingClientRect(),s=e.clientX-a.left,i=e.clientY-a.top,r={x:Math.min(S.x,s),y:Math.min(S.y,i),width:Math.abs(s-S.x),height:Math.abs(i-S.y)};if(r.width>5&&r.height>5){const e=n.getContext("2d").getImageData(r.x,r.y,r.width,r.height);t(e,p,r)}k(!1),C(null),E(null)}}),O&&M&&(0,a.jsx)("div",{style:{position:"absolute",left:O.x,top:O.y,width:O.width,height:O.height,border:"2px dashed #0078d4",background:"rgba(0, 120, 212, 0.1)",pointerEvents:"none",zIndex:10}}),d&&!M&&(0,a.jsx)("div",{style:{position:"absolute",left:d.x,top:d.y,width:d.width,height:d.height,border:"2px solid #e81123",background:"rgba(232, 17, 35, 0.15)",pointerEvents:"none",zIndex:9}})]})})}),(0,a.jsxs)("div",{style:{padding:"4px 12px",background:"#f8f9fa",borderTop:"1px solid #ddd",fontSize:"11px",color:"#666"},children:[n?`Ready to select area for ${i} snip`:"Ready",f&&` • Document loaded: ${y} pages`]})]}):(0,a.jsxs)("div",{style:{padding:"20px",textAlign:"center",color:"#666"},children:[(0,a.jsx)("p",{children:"No document loaded"}),(0,a.jsx)("small",{children:'Click "Import Docs" to load a PDF file'})]})};var u=n(4995);let g=null;async function f(){return g||(g=await(0,u.createWorker)({logger:e=>console.log("OCR:",e)}),await g.loadLanguage("eng"),await g.initialize("eng"),await g.setParameters({tessedit_char_whitelist:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz .,;:!?@#$%^&*()_+-=[]{}|\\;':\",./<>?`~",tessedit_pageseg_mode:"6"}),g)}async function h(e){const t=await f(),{data:n}=await t.recognize(e);return n.text.trim()}async function p(e){return((await h(e)).match(/-?\d+(?:[.,]\d+)?/g)||[]).map((e=>{const t=e.replace(/,/g,"");return parseFloat(t)})).filter((e=>!isNaN(e)))}class x{static async initialize(){await f()}static async terminate(){g&&(await g.terminate(),g=null)}static async recognizeText(e){const t=await f(),{data:n}=await t.recognize(e);return{text:n.text.trim(),confidence:n.confidence}}static async recognizeNumbers(e){return p(e)}}class y{static calculateSum(e){return e.reduce(((e,t)=>e+t),0)}static async extractAndSum(e){const t=await p(e);return{sum:this.calculateSum(t),numbers:t,text:await h(e)}}}async function m(e){await Excel.run((async t=>{const n=t.workbook.getSelectedRange();n.values=[[e]],n.format.autofitColumns(),await t.sync()}))}async function w(){await m("✓")}async function b(){await m("✗")}async function v(){return await Excel.run((async e=>{const t=e.workbook.getSelectedRange();return t.load("address"),await e.sync(),t.address}))}const j=new class{constructor(){this._mode=null}async setMode(e){this._mode=e,await OfficeRuntime.storage.setItem("snip-mode",e),await Office.addin.showAsTaskpane()}async current(){return this._mode?this._mode:OfficeRuntime.storage.getItem("snip-mode")}async clearMode(){this._mode=null,await OfficeRuntime.storage.removeItem("snip-mode")}async isActive(){return null!==await this.current()}};Office.onReady((()=>{Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,(async()=>{try{const e=await j.current();"validation"===e&&(await w(),await j.clearMode()),"exception"===e&&(await b(),await j.clearMode())}catch(e){console.warn("Error handling selection change:",e)}}))}));var M=n(8277),k=n(2272),S=n(8869);const C=()=>{const[e,t]=(0,s.useState)({currentDocument:null,documentName:"",currentMode:null,isSelectionMode:!1,selectedCellAddress:null,isProcessing:!1,statusMessage:"Ready",highlightRect:null,highlightPage:null});(0,s.useEffect)((()=>{x.initialize().catch(console.error);const e=async()=>{try{if(await j.isActive())return;const e=await v(),n=await async function(e){return await Excel.run((async t=>{const n=t.workbook.worksheets.getItemOrNullObject("_Snips");if(await t.sync(),n.isNullObject)return null;const a=n.getUsedRange();a.load(["values","rowCount"]),await t.sync();for(const t of a.values)if(t[0]===e){const[e,n,a,s,i]=t;return{cell:e,page:Number(n),rect:a,mode:s,text:i}}return null}))}(e);t(n?e=>({...e,highlightRect:JSON.parse(n.rect),highlightPage:n.page}):e=>({...e,highlightRect:null,highlightPage:null}))}catch(e){console.error("Error handling highlight:",e)}};return Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionChanged,e),()=>{Office.context.document.removeHandlerAsync(Office.EventType.DocumentSelectionChanged,{handler:e}),x.terminate().catch(console.error)}}),[]),(0,s.useEffect)((()=>{const e=async()=>{try{const e=await j.current(),n=await j.isActive();if(e&&n){t((t=>({...t,currentMode:e,isSelectionMode:"text"===e||"sum"===e||"table"===e,statusMessage:`${e.toUpperCase()} mode active - Select a cell then draw rectangle`})));try{const e=await v();t((t=>({...t,selectedCellAddress:e})))}catch(e){console.warn("Could not get cell address:",e)}}else t((e=>({...e,currentMode:null,isSelectionMode:!1,selectedCellAddress:null,statusMessage:"Ready"})))}catch(e){console.error("Error checking mode:",e)}};e();const n=setInterval(e,1e3);return()=>clearInterval(n)}),[]);const n=(0,s.useCallback)((e=>{const n=e.target.files?.[0];n&&("application/pdf"===n.type||n.type.startsWith("image/")?(n.arrayBuffer().then((e=>{t((t=>({...t,currentDocument:e,documentName:n.name,statusMessage:`Loaded: ${n.name}`})))})).catch((e=>{console.error("Error reading file:",e),t((e=>({...e,statusMessage:"Error loading file"})))})),e.target.value=""):t((e=>({...e,statusMessage:"Please select a PDF file or image"}))))}),[]),i=(0,s.useCallback)((async(n,a,s)=>{if(e.currentMode&&e.selectedCellAddress){t((e=>({...e,isProcessing:!0,statusMessage:"Processing selection..."})));try{let i="",r="";const o=e.currentMode;switch(o){case"text":const e=await x.recognizeText(n);i=e.text,r=e.text,await m(i);break;case"sum":const t=await y.extractAndSum(n);i=t.sum.toString(),r=t.text,await m(i);break;case"table":const a=await x.recognizeText(n),s=a.text.trim().split(/\r?\n/).map((e=>e.split(/\s{2,}|\t/).filter((e=>e.trim().length>0))));s.length>0?(await async function(e){await Excel.run((async t=>{let n;n=t.workbook.getSelectedRange();const a=n.getResizedRange(e.length-1,e[0].length-1);a.values=e,a.format.autofitColumns(),await t.sync()}))}(s),i=`Table (${s.length}x${s[0]?.length||0})`,r=s.map((e=>e.join("\t"))).join("\n")):(i="No table detected",r=a.text,await m(i));break;case"validation":await w(),i="✓",r="Validation mark";break;case"exception":await b(),i="✗",r="Exception mark";break;default:throw new Error(`Unknown mode: ${o}`)}await async function(e){await Excel.run((async t=>{let n=t.workbook.worksheets.getItemOrNullObject("_Snips");await t.sync(),n.isNullObject&&(n=t.workbook.worksheets.add("_Snips"),n.visibility=Excel.SheetVisibility.hidden);const a=n.getRange("A:A").getUsedRange().rowCount+1;n.getRange(`A${a}:E${a}`).values=[[e.cell,e.page,e.rect,e.mode,e.text]],await t.sync()}))}({cell:e.selectedCellAddress,page:a,rect:JSON.stringify(s),mode:o,text:r}),await j.clearMode(),t((e=>({...e,currentMode:null,isSelectionMode:!1,selectedCellAddress:null,isProcessing:!1,statusMessage:`${o.toUpperCase()} snip completed successfully`})))}catch(e){console.error("Error processing snip:",e);const n=e;t((e=>({...e,isProcessing:!1,statusMessage:`Error: ${n?.message||"Processing failed"}`})))}}else t((e=>({...e,statusMessage:"Please select a cell first"})))}),[e.currentMode,e.selectedCellAddress,e.documentName]),r=(0,s.useCallback)((async()=>{await j.clearMode(),t((e=>({...e,currentMode:null,isSelectionMode:!1,selectedCellAddress:null,statusMessage:"Ready"})))}),[]);return(0,a.jsx)(M.q,{theme:k.o,children:(0,a.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,a.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid #ddd",background:"#fff"},children:[(0,a.jsx)(c.E,{size:500,weight:"semibold",children:"SnipperClone - Document Analysis"}),(0,a.jsxs)("div",{style:{marginTop:"12px"},children:[(0,a.jsx)("input",{type:"file",accept:".pdf,image/*",onChange:n,style:{display:"none"},id:"file-input"}),(0,a.jsx)(o.$,{onClick:()=>document.getElementById("file-input")?.click(),appearance:"primary",size:"small",children:"Import Document"}),e.documentName&&(0,a.jsx)(c.E,{size:200,style:{marginLeft:"8px",color:"#666"},children:e.documentName})]})]}),e.currentMode&&(0,a.jsxs)("div",{style:{padding:"8px 16px",background:"#e6f3ff",borderBottom:"1px solid #ccc",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(c.E,{size:300,children:[(0,a.jsxs)("strong",{children:[e.currentMode.toUpperCase()," MODE:"]}),e.selectedCellAddress?` Target cell: ${e.selectedCellAddress}`:" Select a cell first"]}),(0,a.jsx)(o.$,{size:"small",onClick:r,children:"Cancel"})]}),(0,a.jsx)("div",{style:{flex:1,overflow:"hidden"},children:(0,a.jsx)(d,{buffer:e.currentDocument,onSelect:i,isSelectionMode:e.isSelectionMode&&!!e.selectedCellAddress,currentMode:e.currentMode,highlightRect:e.highlightRect,highlightPage:e.highlightPage})}),(0,a.jsxs)("div",{style:{padding:"8px 16px",background:"#f8f9fa",borderTop:"1px solid #ddd",fontSize:"12px",color:"#666",display:"flex",alignItems:"center",gap:"8px"},children:[e.isProcessing&&(0,a.jsx)(S.y,{size:"tiny",label:""}),(0,a.jsxs)("span",{children:["Status: ",e.statusMessage]})]})]})})};Office.onReady((()=>{console.log("Office is ready. Starting React app...");const e=document.getElementById("container");if(!e)throw new Error("Container element not found");(0,i.H)(e).render((0,a.jsx)(C,{}))}))},6959:()=>{},8196:()=>{}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return a[e].call(n.exports,n,n.exports,i),n.exports}i.m=a,e=[],i.O=(t,n,a,s)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,a,s]=e[d],o=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(o=!1,s<r&&(r=s));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,a,s]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var s=Object.create(null);i.r(s);var r={};t=t||[null,n({}),n([]),n(n)];for(var o=2&a&&e;"object"==typeof o&&!~t.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,i.d(s,r),s},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={926:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,s,[r,o,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var d=c(i)}for(t&&t(n);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},n=self.webpackChunksnipper_clone=self.webpackChunksnipper_clone||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=i.O(void 0,[468],(()=>i(6575)));r=i.O(r)})();